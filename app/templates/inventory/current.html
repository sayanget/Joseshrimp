{% extends "base.html" %}

{% block title %}<span data-i18n="inventory.current">当前库存</span> - 销售管理系统{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <h2><i class="bi bi-box-seam"></i> <span data-i18n="inventory.current">当前库存</span></h2>
    </div>
</div>

<!-- 库存概览 -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card {% if stock.warning %}border-danger{% endif %}">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> <span data-i18n="inventory.overview">库存概览</span>
                    {% if stock.warning %}
                    <span class="badge bg-danger" data-i18n="home.stock_warning">库存预警</span>
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-1"><strong data-i18n="inventory.total_stock">库存总量</strong>: <span
                        class="fs-4 text-primary">{{ stock.current_stock_kg|number }} <span
                            data-i18n="common.kg">KG</span></span></p>
                {% if stock.last_move_time %}
                <p class="mb-0 text-muted"><small><span data-i18n="inventory.last_move">最后变动</span>: {{
                        stock.last_move_time|datetime }}</small></p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-lightning"></i> <span data-i18n="home.quick_actions">快速操作</span>
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('inventory.stock_moves') }}" class="btn btn-primary btn-lg">
                        <i class="bi bi-arrow-down-up"></i> <span data-i18n="inventory.moves">库存变动</span>
                    </a>
                    <a href="{{ url_for('inventory.create_purchase') }}" class="btn btn-success btn-lg">
                        <i class="bi bi-plus-circle"></i> <span data-i18n="purchase.create">采购入库</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 按商品统计库存 -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-box-seam"></i> <span data-i18n="inventory.by_product">按商品统计</span></h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th data-i18n="admin.product_name">商品名称</th>
                        <th data-i18n="inventory.stock_kg">库存(KG)</th>
                        <th data-i18n="common.status">状态</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in product_stock %}
                    <tr
                        class="{% if item.stock_kg < 10 %}table-warning{% elif item.stock_kg <= 0 %}table-danger{% endif %}">
                        <td>
                            <a href="{{ url_for('inventory.product_sales', product_name=item.product_name) }}"
                                class="text-decoration-none">
                                <strong>{{ item.product_name }}</strong> <i class="bi bi-box-arrow-up-right"></i>
                            </a>
                        </td>
                        <td><span
                                class="fs-5 {% if item.stock_kg > 0 %}text-success{% elif item.stock_kg == 0 %}text-muted{% else %}text-danger{% endif %}">
                                {{ item.stock_kg|number(3) }} KG
                            </span></td>
                        <td>
                            {% if item.stock_kg <= 0 %} <span class="badge bg-danger"
                                data-i18n="inventory.out_of_stock">缺货</span>
                                {% elif item.stock_kg < 10 %} <span class="badge bg-warning"
                                    data-i18n="inventory.low_stock">库存偏低</span>
                                    {% else %}
                                    <span class="badge bg-success" data-i18n="inventory.in_stock">正常</span>
                                    {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" class="text-center text-muted" data-i18n="common.no_data">暂无数据</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}